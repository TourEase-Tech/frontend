var _=Object.defineProperty;var M=(n,s,d)=>s in n?_(n,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[s]=d;var b=(n,s,d)=>(M(n,typeof s!="symbol"?s+"":s,d),d);import{t as P,u as A,r as g,j as e,C as u,d as x,A as h,T as C,ae as N,i as B,M as q,k as H,p as v,l as w,H as Q,B as S,o as Y,n as R}from"./index-2074f808.js";import{I as E,a as U,D as z,b as G}from"./DemoContainer-db1a7c75.js";import{C as K}from"./CircularProgress-8073ebda.js";import{u as O}from"./useQueryTourConfig-c98073d2.js";import{G as $}from"./getTourById.query-b272236d.js";import{t as J}from"./tour.services-705c3134.js";import"./lodash-aa96f41f.js";import{F as W}from"./comment.rules-382839ce.js";import"./filter_tour.rules-3b6aeaf9.js";import"./index-0ee8233e.js";import"./useQueryParam-3695060a.js";class X{constructor(){b(this,"_queryClient");b(this,"_editTourMutation");b(this,"handle",async(s,d,r)=>{await this._editTourMutation.mutate(s,{onSuccess:()=>{this._queryClient.invalidateQueries({queryKey:["tours"]}),this._queryClient.invalidateQueries({queryKey:["tour"]}),d()},onError:o=>{r(o)}})});this._queryClient=P(),this._editTourMutation=A({mutationFn:s=>J.editTour(s)})}isLoading(){return this._editTourMutation.isLoading}}const Z=({register:n,previewImage:s,onChange:d,errors:r,setValue:o,control:c,tour:a})=>{var f,j;return g.useEffect(()=>{a&&(o("name",a.name),o("destination",a.destination),o("images",a.images),o("departureLocation",a.departureLocation),o("period",a.period),o("price",a.price),o("departureDay",a.departureDay),o("description",a.description))},[a,o]),e.jsx(g.Fragment,{children:a?e.jsxs("div",{className:"flex flex-col mx-6",children:[e.jsx(E,{register:n,id:"name",name:"name",placeholder:"Tour name",className:"",classNameInput:"w-full text-[#195E8E] text-[42px] font-bold placeholder:text-[42px] placeholder:text-[#195E8E] placeholder-bold bg-transparent outline-none",error:(f=r.name)==null?void 0:f.message}),e.jsx(E,{register:n,id:"destination",name:"destination",placeholder:"Destination",className:"col-span-2",classNameInput:"w-full text-black/90 text-[16px] placeholder:text-black/90 bg-transparent outline-none h-[28px]",error:(j=r.destination)==null?void 0:j.message}),e.jsx(U,{register:n,onChange:d,previewImage:s,avatar:a&&a.images}),e.jsxs("div",{className:"grid grid-cols-2 mt-4  gap-x-4 text-[14px] font-semibold text-gray-600 placeholder:text-black",children:[e.jsx(u,{name:"departureLocation",control:c,defaultValue:"",render:({field:{onChange:l,value:i=a&&a.departureDay},fieldState:{error:t}})=>e.jsx(x,{dateAdapter:h,children:e.jsxs("div",{children:[e.jsx(C,{id:"departureLocation",label:"Departure Location",value:i,placeholder:"Enter Location: Ex: Hanoi, Vietnam",className:"w-full bg-white",onChange:l}),e.jsx("span",{className:"block min-h-[16px] text-red-600 text-xs mt-1 font-medium",children:t==null?void 0:t.message})]})})}),e.jsx(u,{name:"period",control:c,defaultValue:"",render:({field:{onChange:l,value:i=a&&a.period},fieldState:{error:t}})=>e.jsx(x,{dateAdapter:h,children:e.jsxs("div",{children:[e.jsx(C,{id:"period",label:"Period",value:i,placeholder:"Enter Period",className:"w-full bg-white",onChange:l}),e.jsx("span",{className:"block min-h-[16px] text-red-600 text-xs mt-1 font-medium",children:t==null?void 0:t.message})]})})}),e.jsx(u,{name:"price",control:c,defaultValue:"",render:({field:{onChange:l,value:i=a&&a.price},fieldState:{error:t}})=>e.jsx(x,{dateAdapter:h,children:e.jsxs("div",{className:"pt-[8px]",children:[e.jsx(C,{id:"price",label:"Price",placeholder:"Enter price",value:i,className:"w-full bg-white",onChange:l}),e.jsx("span",{className:"block min-h-[16px] text-red-600 text-xs mt-1 font-medium",children:t==null?void 0:t.message})]})})}),e.jsx(u,{name:"departureDay",control:c,render:({field:{onChange:l,value:i=a&&a.departureDay},fieldState:{error:t}})=>{var m;return e.jsxs("div",{children:[e.jsx(x,{dateAdapter:h,children:e.jsx(z,{components:["DateTimeField"],children:e.jsx(G,{label:"Departure Day",format:"DD/MM/YYYY HH:mm",onChange:l,value:a?N(i):i!==void 0?N(i):null,className:"bg-white"})})}),e.jsxs("span",{className:"block min-h-[16px] text-red-600 text-xs mt-1 font-medium",children:[t&&t.message,(m=r.departureDay)==null?void 0:m.message]})]})}}),e.jsx(u,{name:"description",defaultValue:"",control:c,render:({field:{onChange:l,value:i=a&&a.description},fieldState:{error:t}})=>e.jsx(x,{dateAdapter:h,children:e.jsxs("div",{className:"col-span-2",children:[e.jsx(C,{id:"description",label:"Description",value:i,placeholder:"Enter Description",className:"w-full bg-white ",multiline:!0,rows:8,onChange:l}),e.jsx("span",{className:"block min-h-[16px] text-red-600 text-xs mt-1 font-medium",children:t==null?void 0:t.message})]})})})]})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-[200px]",children:e.jsx(K,{color:"secondary",variant:"indeterminate"})})})},V=()=>{const[n,s]=g.useState(),d=g.useMemo(()=>n?URL.createObjectURL(n):"",[n]),r=async y=>{s(y),i("images","");try{const p=new FormData;p.append("file",y),p.append("upload_preset","uploadImage");const T=await fetch("https://api.cloudinary.com/v1_1/dz1kgngrn/image/upload",{method:"POST",body:p});if(T.ok){const I=await T.json();i("images",I.secure_url)}else console.log("Failed to uploading file: "+T.statusText)}catch(p){console.log("Failed to uploading file: "+p)}},o=B(),a=q().state,{register:f,handleSubmit:j,control:l,setValue:i,formState:{errors:t}}=H({resolver:Y(W)}),m=O(),F=new $(m.id).fetch(),D=new X,L=j(async y=>{D.handle({...y,id:m.id},()=>{o(v.tour),w.success("Tour updated successfully")},()=>{w.error("Update tour failed")})}),k=()=>{o({pathname:v.tour,search:R(a).toString()})};return e.jsxs(g.Fragment,{children:[e.jsxs(Q,{children:[e.jsx("title",{children:"Edit Tour"}),e.jsx("meta",{name:"description",content:"This is edit tour page of the project"})]}),e.jsxs("form",{onSubmit:L,children:[e.jsx(Z,{register:f,previewImage:d,onChange:r,errors:t,setValue:i,control:l,tour:F}),e.jsxs("div",{className:"flex justify-end gap-6 mx-6",children:[e.jsx(S,{type:"button",classNameButton:"bg-gray-300 py-2 px-4 rounded-lg text-[14px] text-gray-800 font-semibold mt-6",onClick:k,children:"Cancel"}),e.jsx(S,{classNameButton:"bg-[#26C6DA] py-2 px-4 rounded-lg text-[14px] text-white font-semibold mt-6 w-[100px]",type:"submit",isLoading:D.isLoading(),children:"Save"})]})]})]})},ue=V;export{ue as default};
